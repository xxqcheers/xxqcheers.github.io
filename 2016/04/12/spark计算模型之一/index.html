
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>spark计算模型之一 | Backyard of XiaoQiangXu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="xxqcheers">
    
    <meta name="description" content="#引子Spark将应用程序整体翻译为一个有向无环图进行调度和执行，相比MapReduce，Spark提供了更加优化和复杂的执行流。这篇博客在读书和google的基础上对spark计算模型进行宏观的把握。
#spark程序模型spark的实例程序：
 (1) SparkContext中的textFil">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Backyard of XiaoQiangXu" title="Backyard of XiaoQiangXu"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Backyard of XiaoQiangXu">Backyard of XiaoQiangXu</a></h1>
				<h2 class="blog-motto">Walk steps step by step</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">存档</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/todolist">ToDo</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/04/12/spark计算模型之一/" title="spark计算模型之一" itemprop="url">spark计算模型之一</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="xxqcheers">xxqcheers</a>
    </p>
  <p class="article-time">
    <time datetime="2016-04-12T09:24:30.000Z" itemprop="datePublished">2016-04-12</time>
    更新日期:<time datetime="2016-05-18T09:32:12.650Z" itemprop="dateModified">2016-05-18</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RDD简介"><span class="toc-number">1.</span> <span class="toc-text">RDD简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark的数据存储:_RDD"><span class="toc-number">2.</span> <span class="toc-text">Spark的数据存储: RDD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark算子分类及功能"><span class="toc-number">3.</span> <span class="toc-text">Spark算子分类及功能</span></a></li></ol>
		</div>
		
		<p>#引子<br>Spark将应用程序整体翻译为一个有向无环图进行调度和执行，相比MapReduce，Spark提供了更加优化和复杂的执行流。这篇博客在读书和google的基础上对spark计算模型进行宏观的把握。</p>
<p>#spark程序模型<br>spark的实例程序：</p>
<p> (1) SparkContext中的textFile函数从HDFS中读取日志文件，赋值给变量file: var file = sc.textFile(“hdfs://xxx.log”)</p>
<p> (2) RDD中的filter函数过滤带 “ Error ” 的行，输出errors（这里errors也看做一个RDD)：val errors = file.filter(line=&gt;line.contains(“errors”));</p>
<p> (3) RDD的count函数返回 “ ERROR ”的行数：errors.count();</p>
<p>用户程序对RDD通过多个函数进行操作，将RDD进行转换。这里先抛出一个概念：spark是如何管理RDD的物理分析的？ 在spark内部有一个BlockManger管理RDD的物理分区，每个Block就是节点上对应的一个物理块，可以存储在内存中，也可以存储在磁盘中。而RDD中的partition是一个逻辑数据块，对应相应的物理块Block。本质上一个RDD在代码层级中相当于一个元数据结构，存储着数据分区及其逻辑结构映射关系、RDD之间的依赖转换关系。</p>
<p>#弹性分布式数据集:RDD</p>
<p>本节学习Spark中重要的概念RDD。</p>
<h2 id="RDD简介">RDD简介</h2><p>在集群背后，有一个非常重要的分布式数据结构：弹性分布式数据集（Resilient Distributed Dataset），它是逻辑集中的实体，在集群中的多台机器之间进行了数据分区。通过对多台机器上不同RDD分区的控制，就能够减少机器之间的数据重排（data shuffing）。<strong>RDD是spark的核心数据结构，通过RDD的依赖关系形成spark的调度顺序，通过对RDD的操作形成整个Spark程序。</strong></p>
<p>spark内部源码对RDD的概述：</p>
<pre><code>Internally, <span class="keyword">each</span> RDD is characterized <span class="keyword">by</span> <span class="constant">five</span> main properties:
 *
 *  - A list <span class="operator">of</span> partitions
*  - A <span class="function"><span class="keyword">function</span> <span class="title">for</span> <span class="title">computing</span> <span class="title">each</span> <span class="title">split</span></span>
 *  - A list <span class="operator">of</span> dependencies <span class="command"><span class="keyword">on</span> <span class="title">other</span> <span class="title">RDDs</span></span>
*  - Optionally, <span class="operator">a</span> Partitioner <span class="keyword">for</span> key-<span class="built_in">value</span> RDDs (e.g. <span class="built_in">to</span> say that <span class="operator">the</span> RDD is hash-partitioned)
 *  - Optionally, <span class="operator">a</span> list <span class="operator">of</span> preferred locations <span class="built_in">to</span> compute <span class="keyword">each</span> <span class="built_in">split</span> <span class="command"><span class="keyword">on</span> (<span class="title">e</span>.<span class="title">g</span>. <span class="title">block</span> <span class="title">locations</span> <span class="title">for</span></span>
 *    <span class="operator">an</span> HDFS <span class="built_in">file</span>)
</code></pre><ul>
<li>RDD的两种创建方式：从Hadoop文件系统（或与Hadoop兼容的其他持久化存储系统，如hive）输入创建；从父RDD转换得到新的RDD</li>
<li>RDD的两种转换算子：对于RDD可以有两种计算操作算子：Transformation(变换)与Action(行动)<ul>
<li>Transformation（变换）：Transformation操作是延迟计算的，也就是说从一个RDD转换生成另一个RDD的转换操作不是马上执行，需要等到有Actions操作时，才能真正触发运算。</li>
<li>Action（行动）：Action转换算子会触发spark提交作业，并将数据输出到spark系统</li>
</ul>
</li>
<li>RDD的重要内部属性：参考源码中的解释，Internally, each RDD is characterized by five main properties:<ul>
<li>A list of partitions ：一组分片（partition），即数据集的基本组成单位</li>
<li>A function for computing each split：一个用于计算每个分片的函数</li>
<li>A list of dependencies on other RDDs：对parent RDD的依赖，这个依赖描述了RDD之间的lineage</li>
<li>Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)：对于key-value的RDD，一个Partitioner</li>
<li>Optionally, a list of preferred locations to compute each split on (e.g. block locations for an HDFS file)：一个列表，存储存取每个partition的preferred位置。对于一个HDFS文件来说，存储每个partition所在的块的位置。</li>
</ul>
</li>
</ul>
<p>org.apache.spark.rdd.RDD是一个抽象类，定义了RDD的基本操作和属性。这些基本操作包括map，filter和persist。另外，org.apache.spark.rdd.PairRDDFunctions定义了key-value类型的RDD的操作，包括groupByKey，join，reduceByKey，countByKey，saveAsHadoopFile等。org.apache.spark.rdd.SequenceFileRDDFunctions包含了所有的RDD都适用的saveAsSequenceFile。</p>
<h2 id="Spark的数据存储:_RDD">Spark的数据存储: RDD</h2><p>Spark数据存储的核心是弹性分布式数据集（RDD）。RDD可以被抽象地理解为一个大的数组Array，但是这个数组是分布在集群上的，逻辑上RDD的每个分区叫一个Partition。</p>
<p>在Spark的执行过程中，RDD经历一个个的Transformation算子之后【其实可以看做延迟执行，也就是说经历Transformation操作后，只是在RDD元数据中记录下来】，最后通过Action算子进行触发操作。逻辑上每经历一次变化，就会将RDD转换为一个新的RDD, 这些RDD之间通过Lineage产生依赖关系，这个关系在容错机制中起到恨大的作用。Transformation的输入和输出都是RDD。RDD会被划分成很多的分区分布到集群的多个节点中。分区是个逻辑概念，变换前后的新旧分区在物理上有可能是同一块内存存储。有些RDD是计算的中间结果，其分区并不一定有相应的内存或磁盘数据与之对应，如果要迭代使用数据，可以使用cache()函数缓存数据。</p>
<h2 id="Spark算子分类及功能">Spark算子分类及功能</h2><p>本节主要涉及到Spark算子的作用，以及算子的分类</p>
<p>《Spark大数据处理：技术、应用与性能优化》中有一幅图用于描述Spark的输入、运行转换、输出。在运行转换中通过Spark算子对RDD进行转换，那么什么是算子呢，算子的概念可以通过数学中的算子来理解，算子是RDD中定义的函数，可以对RDD中的数据进行转换和操作。</p>
<p><strong>输入</strong>：在Spark程序运行中，数据从外部数据空间（如分布式存储：textFile读取HDFS等，parallelize方法输入Scala集合或数据）输入Spark，数据进入Spark运行时数据空间，转化为Spark中的数据块，通过BlockManager进行管理。</p>
<p><strong>运行</strong>：在Spark数据输入形成RDD后便可以通过变换算子，如filter等，对数据进行操作并将RDD转化为新的RDD，通过Action算子，触发Spark提交作业。 如果数据需要复用，可以通过Cache算子，将数据缓存到内存。</p>
<p><strong>输出</strong>：程序运行结束数据会输出Spark运行时空间，存储到分布式存储中（如saveAsTextFile输出到HDFS），或Scala数据或集合中（collect输出到Scala集合，count返回Scala int型数据）。</p>
<p>Spark的核心数据模型是RDD,但RDD是个抽象类，具体由各子类实现，如ShuffledRDD,MappedRDD等子类。Spark将常用的大数据操作都转换为RDD的子类。</p>
<p><strong>算子的分类：</strong></p>
<ul>
<li>Value数据类型的Transformation算子，这种变换并不触发提交作业，针对处理的数据项是Value型的数据。</li>
<li>Key-Value数据类型的Transfromation算子，这种变换并不触发提交作业，针对处理的数据项是Key-Value型的数据对。</li>
<li>Action算子，这类算子会触发SparkContext提交Job作业。</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/分布式计算/">分布式计算</a><a href="/tags/大数据/">大数据</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Spark/">Spark</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2016/04/12/spark计算模型之一/" data-title="spark计算模型之一 | Backyard of XiaoQiangXu" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/08/15/maven工具笔记/"  title="maven工具笔记">
 <strong>NEXT:</strong><br/> 
 <span>maven工具笔记
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RDD简介"><span class="toc-number">1.</span> <span class="toc-text">RDD简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark的数据存储:_RDD"><span class="toc-number">2.</span> <span class="toc-text">Spark的数据存储: RDD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark算子分类及功能"><span class="toc-number">3.</span> <span class="toc-text">Spark算子分类及功能</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/categories/Spark/" title="Spark">Spark<sup>1</sup></a></li>
		
			<li><a href="/categories/java语言/" title="java语言">java语言<sup>1</sup></a></li>
		
			<li><a href="/categories/工具/" title="工具">工具<sup>1</sup></a></li>
		
			<li><a href="/categories/机器学习/" title="机器学习">机器学习<sup>2</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/分布式计算/" title="分布式计算">分布式计算<sup>2</sup></a></li>
		
			<li><a href="/tags/大数据/" title="大数据">大数据<sup>2</sup></a></li>
		
			<li><a href="/tags/开发工具/" title="开发工具">开发工具<sup>1</sup></a></li>
		
			<li><a href="/tags/推荐系统-隐语义模型-文本分类-矩阵分解/" title="推荐系统,隐语义模型,文本分类,矩阵分解">推荐系统,隐语义模型,文本分类,矩阵分解<sup>1</sup></a></li>
		
			<li><a href="/tags/特征处理-预处理/" title="特征处理 预处理">特征处理 预处理<sup>1</sup></a></li>
		
			<li><a href="/tags/编程基础/" title="编程基础">编程基础<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://tech.meituan.com/" target="_blank" title="YangJian">MeiTuan Technology</a></li>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/分布式计算/" style="font-size: 20px;">分布式计算</a> <a href="/tags/大数据/" style="font-size: 20px;">大数据</a> <a href="/tags/开发工具/" style="font-size: 10px;">开发工具</a> <a href="/tags/推荐系统-隐语义模型-文本分类-矩阵分解/" style="font-size: 10px;">推荐系统,隐语义模型,文本分类,矩阵分解</a> <a href="/tags/特征处理-预处理/" style="font-size: 10px;">特征处理 预处理</a> <a href="/tags/编程基础/" style="font-size: 10px;">编程基础</a>
    </div>
  </div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2016 
		
		<a href="http://yoursite.com" target="_blank" title="xxqcheers">xxqcheers</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
